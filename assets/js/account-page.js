function M({AppState:i,Utils:o,Modal:l},p={}){let f={autoShowAuth:p.autoShowAuth!==void 0?p.autoShowAuth:!0,persistAuthOnLogin:p.persistAuthOnLogin===!0,profilePortalUrl:typeof p.profilePortalUrl=="string"&&p.profilePortalUrl.trim()?p.profilePortalUrl.trim():null,profilePortalTarget:p.profilePortalTarget==="_self"?"_self":"_blank"};function w(){if(!f.profilePortalUrl)return!1;if(f.profilePortalTarget==="_self")return window.location.href=f.profilePortalUrl,!0;let t=window.open(f.profilePortalUrl,"_blank");return t?(t.opener=null,!0):!1}let S={window:null,body:null,form:null,input:null,closeBtn:null,openBtn:null,isOpen:!1,hasWelcomed:!1,init(){this.window=document.getElementById("chatWindow"),this.body=document.getElementById("chatBody"),this.form=document.getElementById("chatForm"),this.input=document.getElementById("chatMessage"),this.closeBtn=document.getElementById("chatCloseBtn"),this.openBtn=document.getElementById("supportChatBtn"),!(!this.window||!this.body)&&(this.form&&this.form.addEventListener("submit",t=>{t.preventDefault(),this.sendMessage()}),this.closeBtn&&this.closeBtn.addEventListener("click",()=>this.close()),this.openBtn&&(this.openBtn.setAttribute("aria-expanded","false"),this.openBtn.addEventListener("click",()=>this.toggle())),this.window.setAttribute("aria-hidden","true"),this.ensureGreeting())},ensureGreeting(){this.hasWelcomed||(this.appendMessage("bot","Ol\xE1! Sou da equipe Amex Store. Como posso ajudar voc\xEA hoje?"),this.hasWelcomed=!0)},open(){this.window&&(this.window.classList.add("active"),this.window.setAttribute("aria-hidden","false"),this.isOpen=!0,this.openBtn&&(this.openBtn.classList.add("open"),this.openBtn.setAttribute("aria-expanded","true"),this.openBtn.setAttribute("aria-label","Fechar chat de suporte ao vivo")),this.ensureGreeting(),this.input&&requestAnimationFrame(()=>this.input.focus()),this.scrollToBottom())},close(){this.window&&(this.window.classList.remove("active"),this.window.setAttribute("aria-hidden","true"),this.isOpen=!1,this.openBtn&&(this.openBtn.classList.remove("open"),this.openBtn.setAttribute("aria-expanded","false"),this.openBtn.setAttribute("aria-label","Abrir chat de suporte ao vivo")),this.input&&this.input.blur())},toggle(){this.isOpen?this.close():this.open()},appendMessage(t,e){if(!this.body)return;let s=document.createElement("div");s.className=`chat-message ${t}`;let a=document.createElement("span");a.textContent=e,s.appendChild(a),this.body.appendChild(s),this.scrollToBottom()},generateReply(t){let e=t.toLowerCase();return e.includes("prazo")||e.includes("entrega")?"Os produtos digitais s\xE3o liberados automaticamente ap\xF3s a confirma\xE7\xE3o do pagamento. Se tiver algum atraso, me envie o comprovante.":e.includes("garantia")||e.includes("reembolso")?"Oferecemos garantia imediata durante o processo de entrega. Assim que receber seus dados, teste e fale conosco se notar algo fora do esperado.":e.includes("pagamento")||e.includes("pix")?"Aceitamos Pix e alguns cart\xF5es via parceiros. Ap\xF3s pagar, envie o comprovante para agilizar a ativa\xE7\xE3o.":e.includes("contato")||e.includes("whatsapp")||e.includes("discord")?"Pode chamar a gente pelo WhatsApp (16) 99276-4211 ou Discord 9797x. Estamos online na maior parte do dia.":"Entendi! Se precisar de algo espec\xEDfico, me conte com detalhes e eu te direciono para o melhor caminho."},sendMessage(){if(!this.input)return;let t=this.input.value.trim();t&&(this.appendMessage("user",t),this.input.value="",setTimeout(()=>{this.appendMessage("bot",this.generateReply(t))},600))},scrollToBottom(){this.body&&(this.body.scrollTop=this.body.scrollHeight)}},b={button:null,label:null,avatar:null,modal:null,closeBtn:null,form:null,nameInput:null,emailInput:null,passwordInput:null,summaryName:null,summaryEmail:null,summaryAvatar:null,logoutBtn:null,avatarInput:null,avatarTrigger:null,avatarReset:null,historyList:null,historyEmpty:null,historyRefresh:null,init(){this.button=document.getElementById("profileBtn"),this.label=this.button?this.button.querySelector(".profile-label"):null,this.avatar=this.button?this.button.querySelector(".profile-avatar"):null,this.modal=document.getElementById("profileModal"),this.closeBtn=document.getElementById("closeProfileModal"),this.form=document.getElementById("profileForm"),this.nameInput=document.getElementById("profileName"),this.emailInput=document.getElementById("profileEmail"),this.passwordInput=document.getElementById("profilePassword"),this.summaryName=document.getElementById("profileSummaryName"),this.summaryEmail=document.getElementById("profileSummaryEmail"),this.summaryAvatar=document.getElementById("profileSummaryAvatar"),this.logoutBtn=document.getElementById("logoutBtn"),this.avatarInput=document.getElementById("profileAvatarInput"),this.avatarTrigger=document.getElementById("profileAvatarTrigger"),this.avatarReset=document.getElementById("profileAvatarReset"),this.historyList=document.getElementById("profileHistoryList"),this.historyEmpty=document.getElementById("profileHistoryEmpty"),this.historyRefresh=document.getElementById("profileHistoryRefresh"),this.button&&(f.profilePortalUrl?this.button.addEventListener("click",t=>{t.preventDefault(),w()}):this.button.addEventListener("click",()=>{if(!n.isAuthenticated()||!i.currentUser){n.show("loginForm");return}n.show("accountForm")})),this.closeBtn&&this.closeBtn.addEventListener("click",()=>{l.close("profileModal"),f.persistAuthOnLogin&&n.show("accountForm")}),this.form&&this.form.addEventListener("submit",t=>{t.preventDefault(),this.saveProfile()}),this.logoutBtn&&this.logoutBtn.addEventListener("click",()=>{l.close("profileModal"),n.logout()}),this.avatarTrigger&&this.avatarInput&&this.avatarTrigger.addEventListener("click",()=>{if(!n.isAuthenticated()||!i.currentUser){n.show("loginForm");return}this.avatarInput.click()}),this.avatarInput&&this.avatarInput.addEventListener("change",t=>{let e=t.target.files&&t.target.files[0];e&&(this.handleAvatarFile(e),t.target.value="")}),this.avatarReset&&this.avatarReset.addEventListener("click",()=>this.resetAvatar()),this.historyRefresh&&this.historyRefresh.addEventListener("click",()=>this.renderPurchases(!0)),this.updateUI(),this.renderPurchases(),this.updateAvatarControls()},populateForm(){i.currentUser&&(this.nameInput&&(this.nameInput.value=i.currentUser.name||""),this.emailInput&&(this.emailInput.value=i.currentUser.email||""),this.passwordInput&&(this.passwordInput.value=""),this.updateSummary(i.currentUser),this.updateAvatarControls(),this.renderPurchases())},openModal(){if(!n.isAuthenticated()||!i.currentUser){n.show("loginForm");return}this.populateForm(),n.hide(),l.open("profileModal")},saveProfile(){if(!i.currentUser){o.showToast("Faca login para editar o perfil.","warning");return}let t=(this.nameInput?this.nameInput.value:"").trim(),e=(this.emailInput?this.emailInput.value:"").trim().toLowerCase(),s=(this.passwordInput?this.passwordInput.value:"").trim();if(!t){o.showToast("Informe um nome valido.","warning");return}if(!e){o.showToast("Informe um e-mail valido.","warning");return}let a=i.currentUser.email;if(e!==a&&n.users.some(u=>u.email===e)){o.showToast("Este e-mail ja esta em uso.","error");return}let r=n.users.findIndex(u=>u.email===a);if(r===-1){o.showToast("Conta nao encontrada. Faca login novamente.","error"),n.logout();return}n.users[r].name=t,n.users[r].email=e,s&&(n.users[r].password=s),localStorage.setItem("amexUsers",JSON.stringify(n.users)),i.currentUser={name:t,email:e},localStorage.setItem("amexCurrentUser",JSON.stringify(i.currentUser));let c=document.getElementById("loginEmail");c&&(c.value=e),this.passwordInput&&(this.passwordInput.value=""),this.updateSummary(i.currentUser),this.updateAvatarControls(),this.renderPurchases(),this.updateUI(),n.updateAccountState(),o.showToast("Perfil atualizado com sucesso!","success")},updateSummary(t){if(!t){this.summaryName&&(this.summaryName.textContent="Visitante"),this.summaryEmail&&(this.summaryEmail.textContent="---"),this.applyAvatarToElement(this.summaryAvatar,"","?");return}this.summaryName&&(this.summaryName.textContent=t.name||"Visitante"),this.summaryEmail&&(this.summaryEmail.textContent=t.email||"---"),this.applyAvatarToElement(this.summaryAvatar,t.name,"?")},updateUI(){let t=n.isAuthenticated()&&!!i.currentUser;this.button&&this.button.classList.toggle("logged",t);let e=t&&i.currentUser?i.currentUser.name:"";this.label&&(this.label.textContent=t?this.getFirstName(e):"Entrar"),this.applyAvatarToElement(this.avatar,e,"?"),this.updateSummary(t?i.currentUser:null),this.updateAvatarControls()},updateAvatarControls(){if(this.avatarReset){let t=!!i.profileAvatar&&n.isAuthenticated()&&!!i.currentUser;this.avatarReset.disabled=!t}},handleAvatarFile(t){if(!n.isAuthenticated()||!i.currentUser){n.show("loginForm");return}let e=2*1024*1024;if(!t.type||!t.type.startsWith("image/")){o.showToast("Selecione uma imagem valida.","warning");return}if(t.size>e){o.showToast("Escolha uma imagem menor que 2MB.","warning");return}let s=new FileReader;s.onload=()=>{i.profileAvatar=s.result,o.saveToStorage(),this.updateUI(),o.showToast("Foto de perfil atualizada!","success")},s.onerror=()=>{o.showToast("Nao foi possivel carregar a imagem.","error")},s.readAsDataURL(t)},resetAvatar(){if(!n.isAuthenticated()||!i.currentUser){n.show("loginForm");return}i.profileAvatar&&(i.profileAvatar=null,o.saveToStorage(),this.updateUI(),o.showToast("Foto de perfil removida.","info"))},applyAvatarToElement(t,e="",s="?"){if(!t)return;let a=!!i.profileAvatar&&n.isAuthenticated()&&!!i.currentUser;if(t.classList.toggle("has-photo",a),a)t.style.backgroundImage="url("+i.profileAvatar+")",t.style.backgroundSize="cover",t.style.backgroundPosition="center",t.style.backgroundRepeat="no-repeat",t.style.backgroundColor="#0f1e19",t.textContent="";else{t.style.backgroundImage="",t.style.backgroundSize="",t.style.backgroundPosition="",t.style.backgroundRepeat="",t.style.backgroundColor="";let r=this.getInitial(e)||s;t.textContent=r}},renderPurchases(t=!1){if(!this.historyList||!this.historyEmpty)return;let e=n.isAuthenticated()&&!!i.currentUser,s=Array.isArray(i.purchases)?i.purchases:[];if(this.historyList.innerHTML="",!e){this.historyEmpty.textContent="Entre para visualizar suas compras.",this.historyEmpty.hidden=!1,this.historyList.hidden=!0;return}if(!s.length){this.historyEmpty.textContent="Voce ainda nao realizou nenhuma compra.",this.historyEmpty.hidden=!1,this.historyList.hidden=!0;return}this.historyEmpty.hidden=!0,this.historyList.hidden=!1,s.forEach(a=>{let r=this.getPurchaseStatus(a),c=this.formatDate(a.purchaseDate),u=a.expiresAt?this.formatDate(a.expiresAt):"Sem data de expiracao",m=document.createElement("li");m.className="profile-history-item";let y=document.createElement("div"),v=document.createElement("h5");v.textContent=a.name,y.appendChild(v);let h=document.createElement("div");h.className="profile-history-meta",[{icon:"fa-calendar-alt",text:c},{icon:"fa-stopwatch",text:a.duration||"---"},{icon:"fa-wallet",text:o.formatPrice(a.price||0)},{icon:"fa-hourglass-half",text:u}].forEach(({icon:x,text:U})=>{let B=document.createElement("span"),A=document.createElement("i");A.className="fas "+x,A.setAttribute("aria-hidden","true"),B.appendChild(A),B.appendChild(document.createTextNode(" "+U)),h.appendChild(B)}),y.appendChild(h);let E=document.createElement("div");E.className="profile-history-status "+r.className;let C=document.createElement("i");C.className="fas "+r.icon,C.setAttribute("aria-hidden","true");let F=document.createElement("span");F.textContent=r.label,E.append(C,F),m.append(y,E),this.historyList.appendChild(m)}),t&&o.showToast("Historico atualizado!","info")},getPurchaseStatus(t){if(!t||!t.expiresAt)return{label:"Acesso vitalicio",className:"permanent",icon:"fa-infinity"};let e=new Date(t.expiresAt);if(Number.isNaN(e.getTime()))return{label:"Validade indisponivel",className:"permanent",icon:"fa-question-circle"};let s=new Date,a=e.getTime()-s.getTime();if(a<=0){let c=Math.max(1,Math.floor(Math.abs(a)/864e5));return{label:c<=1?"Expirado":"Expirado ha "+c+" dias",className:"expired",icon:"fa-exclamation-triangle"}}let r=Math.ceil(a/(1e3*60*60*24));return r<=1?{label:"Expira em menos de 24h",className:"valid",icon:"fa-clock"}:{label:"Expira em "+r+" dias",className:"valid",icon:"fa-clock"}},formatDate(t){if(!t)return"--";try{return new Intl.DateTimeFormat("pt-BR",{dateStyle:"short",timeStyle:"short"}).format(new Date(t))}catch(e){return new Date(t).toLocaleString("pt-BR")}},getInitial(t=""){let e=t.trim();return e?e.charAt(0).toUpperCase():"?"},getFirstName(t=""){let e=t.trim();if(!e)return"Perfil";let s=e.split(/\s+/);return s.length?s[0]:e},onLogin(){this.updateUI(),this.renderPurchases(),n.updateAccountState()},onLogout(){this.modal&&l.close("profileModal"),this.passwordInput&&(this.passwordInput.value=""),this.renderPurchases(),this.updateUI(),n.updateAccountState()},onPurchaseRecorded(){this.renderPurchases(!0)}},I={element:null,closeBtn:null,message:null,dismissed:!1,init(){if(this.element=document.getElementById("onboardingTips"),!this.element)return;this.closeBtn=document.getElementById("closeOnboardingTips"),this.message=document.getElementById("onboardingMessage"),this.dismissed=localStorage.getItem("amexOnboardingDismissed")==="true",this.closeBtn&&this.closeBtn.addEventListener("click",()=>this.hide(!0)),this.element.querySelectorAll("[data-scroll-target]").forEach(e=>{let s=e.getAttribute("data-scroll-target");if(!s)return;e.addEventListener("click",r=>{r.target.closest("button")||(this.scrollTo(s),this.hide(!1))});let a=e.querySelector("button");a&&a.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),this.scrollTo(s),this.hide(!1)})}),this.element.querySelectorAll("[data-open-support]").forEach(e=>{e.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),o.openSupportChannel(),this.hide(!1)});let s=e.querySelector("button");s&&s.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),o.openSupportChannel(),this.hide(!1)})});let t=document.getElementById("accountGuideBtn");t&&t.addEventListener("click",()=>{this.dismissed=!1,localStorage.removeItem("amexOnboardingDismissed"),n.hide(),this.show(i.currentUser?i.currentUser.name:"",{force:!0})})},show(t="",e={}){if(!this.element)return;let s=e.force===!0;if(s&&(this.dismissed=!1),!(this.dismissed&&!s)){if(this.message)if(t){let a=t.trim().split(/\s+/)[0]||t;this.message.textContent=`Oi, ${a}! Comece com uma destas sugestoes.`}else this.message.textContent="Comece com uma destas sugestoes para aproveitar melhor a loja.";this.element.removeAttribute("hidden"),this.element.classList.add("visible"),this.element.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{this.element.scrollIntoView({behavior:"smooth",block:"center"})})}},hide(t=!1){this.element&&(this.element.classList.remove("visible"),this.element.setAttribute("hidden",""),this.element.setAttribute("aria-hidden","true"),t&&(this.dismissed=!0,localStorage.setItem("amexOnboardingDismissed","true")))},scrollTo(t){if(!t)return;let e=document.querySelector(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}},n={overlay:null,tabContainer:null,tabIndicator:null,tabs:[],forms:[],users:[],activeTabId:"loginForm",handleResize:null,accountTab:null,loginTab:null,registerTab:null,accountForm:null,accountNameEl:null,accountEmailEl:null,accountAvatarEl:null,accountProfileBtn:null,accountLogoutBtn:null,init(){if(this.overlay=document.getElementById("authOverlay"),!this.overlay)return;this.tabContainer=this.overlay.querySelector(".auth-tabs"),this.tabIndicator=this.overlay.querySelector(".auth-tab-indicator"),this.tabs=Array.from(this.overlay.querySelectorAll(".auth-tab")),this.forms=Array.from(this.overlay.querySelectorAll(".auth-form")),this.users=JSON.parse(localStorage.getItem("amexUsers")||"[]"),this.accountTab=this.overlay.querySelector(".auth-tab.account-tab"),this.loginTab=this.overlay.querySelector('.auth-tab[data-target="loginForm"]'),this.registerTab=this.overlay.querySelector('.auth-tab[data-target="registerForm"]'),this.accountForm=document.getElementById("accountForm"),this.accountNameEl=document.getElementById("accountUserName"),this.accountEmailEl=document.getElementById("accountUserEmail"),this.accountAvatarEl=document.getElementById("accountAvatar"),this.accountProfileBtn=document.getElementById("accountProfileBtn"),this.accountLogoutBtn=document.getElementById("accountLogoutBtn"),this.activeTabId="loginForm",this.tabContainer&&this.tabContainer.setAttribute("data-tab-count","2"),this.handleResize&&window.removeEventListener("resize",this.handleResize),this.handleResize=()=>this.moveIndicatorTo(this.activeTabId),window.addEventListener("resize",this.handleResize),this.bindTabEvents(),this.bindFormEvents(),this.bindPasswordToggle(),this.bindAccountActions(),this.updateAccountState(),this.isAuthenticated()&&!!i.currentUser?(b.onLogin(),this.activate("accountForm"),f.persistAuthOnLogin?this.show("accountForm"):this.hide()):(b.onLogout(),this.activate("loginForm"),f.autoShowAuth||f.persistAuthOnLogin?this.show("loginForm"):this.hide())},bindTabEvents(){this.tabs.forEach(t=>{t.addEventListener("click",()=>{let e=t.dataset.target;if(e==="accountForm"&&!this.isAuthenticated()){this.activate("loginForm");return}this.activate(e)})}),this.overlay.querySelectorAll(".auth-switch a").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();let s=t.dataset.target;s&&this.activate(s)})})},moveIndicatorTo(t){if(!this.tabIndicator||!this.tabContainer)return;let e=t||this.activeTabId||"loginForm",s=this.tabContainer.querySelector(`.auth-tab[data-target="${e}"]`);if(!s||s.offsetParent===null){this.tabIndicator.style.opacity="0";return}window.requestAnimationFrame(()=>{let{offsetLeft:a,offsetWidth:r}=s;this.tabIndicator.style.opacity="1",this.tabIndicator.style.transform=`translateX(${a}px)`,this.tabIndicator.style.width=`${r}px`})},bindPasswordToggle(){this.overlay.querySelectorAll(".toggle-password").forEach(t=>{t.addEventListener("click",()=>{let e=document.getElementById(t.dataset.target);if(!e)return;let s=e.type==="password";e.type=s?"text":"password",t.innerHTML=s?'<i class="fas fa-eye-slash"></i>':'<i class="fas fa-eye"></i>'})})},bindAccountActions(){this.accountProfileBtn&&this.accountProfileBtn.addEventListener("click",t=>{if(f.profilePortalUrl){t.preventDefault(),w();return}b.openModal()}),this.accountLogoutBtn&&this.accountLogoutBtn.addEventListener("click",()=>{this.logout()})},bindFormEvents(){let t=document.getElementById("loginForm"),e=document.getElementById("registerForm");t&&t.addEventListener("submit",s=>{s.preventDefault();let a=t.querySelector("#loginEmail").value.trim().toLowerCase(),r=t.querySelector("#loginPassword").value,c=this.users.find(u=>u.email===a&&u.password===r);if(!c){o.showToast("Credenciais invalidas. Verifique e tente novamente.","error");return}localStorage.setItem("amexAuth","true"),i.currentUser={name:c.name,email:c.email},localStorage.setItem("amexCurrentUser",JSON.stringify(i.currentUser)),b.onLogin(),t.reset(),f.persistAuthOnLogin?(this.activate("accountForm"),this.show("accountForm")):this.hide(),setTimeout(()=>{o.showWelcomeToast(c.name),sessionStorage.getItem("amexPendingOnboardingName")?(I.show(c.name,{force:!0}),sessionStorage.removeItem("amexPendingOnboardingName")):I.show(c.name)},200)}),e&&e.addEventListener("submit",s=>{s.preventDefault();let a=e.querySelector("#registerName").value.trim();if(!a){o.showToast("Informe um nome de usuario valido.","warning");return}let r=e.querySelector("#registerEmail").value.trim().toLowerCase(),c=e.querySelector("#registerPassword").value;if(c.length<6){o.showToast("A senha deve ter pelo menos 6 caracteres.","warning");return}if(this.users.some(v=>v.email===r)){o.showToast("Ja existe uma conta com este e-mail.","error"),this.activate("loginForm");return}let u={name:a,email:r,password:c};this.users.push(u),localStorage.setItem("amexUsers",JSON.stringify(this.users)),sessionStorage.setItem("amexPendingOnboardingName",a),localStorage.removeItem("amexOnboardingDismissed"),o.showToast("Cadastro realizado com sucesso, "+a+"! Agora faca login.","success"),e.reset(),this.activate("loginForm");let m=document.getElementById("loginEmail");m&&(m.value=r,m.focus());let y=document.getElementById("loginPassword");y&&(y.value="")})},activate(t="loginForm"){let e=this.isAuthenticated()&&!!i.currentUser;t==="accountForm"&&!e&&(t="loginForm"),e&&(t==="loginForm"||t==="registerForm")&&(t="accountForm"),this.activeTabId=t,this.forms.forEach(s=>{let a=s.id===t;s.classList.toggle("active",a),s.toggleAttribute("hidden",!a),s.setAttribute("aria-hidden",a?"false":"true")}),this.tabs.forEach(s=>{let a=s.dataset.target===t;s.classList.toggle("active",a),s.setAttribute("aria-selected",a?"true":"false"),s.setAttribute("tabindex",a?"0":"-1")}),this.moveIndicatorTo(t)},show(t="loginForm"){let e=this.isAuthenticated()&&!!i.currentUser;t==="accountForm"&&!e&&(t="loginForm"),e&&(t==="loginForm"||t==="registerForm")&&(t="accountForm"),this.updateAccountState(),this.updateCloseButton(),this.activate(t),document.body.classList.contains("account-standalone")?document.body.classList.remove("auth-locked"):document.body.classList.add("auth-locked"),this.overlay.classList.add("active")},hide(){document.body.classList.remove("auth-locked"),this.overlay.classList.remove("active")},logout(){localStorage.removeItem("amexAuth"),localStorage.removeItem("amexCurrentUser"),i.currentUser=null,b.onLogout(),this.show("loginForm"),o.showToast("Sessao encerrada. Faca login para continuar.","info")},updateCloseButton(){let t=document.getElementById("authModalClose");if(!t)return;let e=this.isAuthenticated()&&!!i.currentUser;t.classList.toggle("visible",e),t.setAttribute("aria-hidden",e?"false":"true"),t.removeEventListener("click",this.handleCloseClick),e&&t.addEventListener("click",this.handleCloseClick)},handleCloseClick:()=>{n.hide()},updateAccountState(){let t=this.isAuthenticated()&&!!i.currentUser;if(this.accountTab&&(this.accountTab.classList.toggle("visible",t),this.accountTab.setAttribute("aria-hidden",t?"false":"true"),this.accountTab.toggleAttribute("disabled",!t),this.accountTab.toggleAttribute("hidden",!t),this.accountTab.setAttribute("tabindex",t&&this.accountTab.classList.contains("active")?"0":"-1"),t||this.accountTab.blur()),this.loginTab&&(this.loginTab.classList.toggle("hidden",t),this.loginTab.setAttribute("aria-hidden",t?"true":"false"),this.loginTab.toggleAttribute("hidden",t)),this.registerTab&&(this.registerTab.classList.toggle("hidden",t),this.registerTab.setAttribute("aria-hidden",t?"true":"false"),this.registerTab.toggleAttribute("hidden",t)),this.tabContainer&&this.tabContainer.setAttribute("data-tab-count",t?"3":"2"),this.accountForm&&(this.accountForm.classList.toggle("available",t),this.accountForm.setAttribute("aria-hidden",t?"false":"true"),this.accountForm.toggleAttribute("hidden",!t),!t&&this.accountForm.classList.contains("active")&&this.activate("loginForm")),this.accountNameEl&&(this.accountNameEl.textContent=t&&i.currentUser?i.currentUser.name:"Visitante"),this.accountEmailEl&&(this.accountEmailEl.textContent=t&&i.currentUser?i.currentUser.email:"---"),this.accountAvatarEl){let e=t&&i.currentUser?i.currentUser.name:"",s=e?e.trim().charAt(0).toUpperCase():"?";this.accountAvatarEl.textContent=s||"?"}this.updateCloseButton(),this.moveIndicatorTo(this.activeTabId)},isAuthenticated(){return localStorage.getItem("amexAuth")==="true"}},L=!1;function N(){L||(L=!0,S.init(),I.init(),b.init(),n.init())}return{ChatWidget:S,Profile:b,Auth:n,Onboarding:I,initialize:N,isInitialized:()=>L}}var d={cart:JSON.parse(localStorage.getItem("amexCart"))||[],favorites:JSON.parse(localStorage.getItem("amexFavorites"))||[],theme:localStorage.getItem("amexTheme")||"light",currentUser:JSON.parse(localStorage.getItem("amexCurrentUser"))||null,purchases:JSON.parse(localStorage.getItem("amexPurchases")||"[]"),profileAvatar:localStorage.getItem("amexProfileAvatar")||null},k={formatPrice:i=>`R$ ${Number.parseFloat(i||0).toFixed(2).replace(".",",")}`,openSupportChannel:()=>{window.open("https://wa.me/5516992764211?text=Ola%2C%20preciso%20de%20ajuda%20com%20minha%20conta.","_blank")},showToast:(i,o="info")=>{var w;let l=document.createElement("div");l.className=`toast ${o}`,l.innerHTML=`
            <i class="toast-icon fas ${o==="success"?"fa-check-circle":o==="error"?"fa-exclamation-circle":o==="warning"?"fa-exclamation-triangle":"fa-info-circle"}"></i>
            <span class="toast-message">${i}</span>
            <button class="toast-close" type="button" aria-label="Fechar notifica&ccedil;&atilde;o">&times;</button>
        `;let p=document.getElementById("toastContainer");if(!p)return;for(;p.children.length>=4;)p.removeChild(p.firstElementChild);p.appendChild(l);let f=()=>{l.parentNode&&l.remove()};(w=l.querySelector(".toast-close"))==null||w.addEventListener("click",f),setTimeout(f,6e3)},showWelcomeToast:(i="")=>{let o=(i||"").trim().split(/\s+/)[0]||"Amigo";k.showToast(`Bem-vindo de volta, ${o}!`,"success")},saveToStorage:()=>{localStorage.setItem("amexCart",JSON.stringify(d.cart||[])),localStorage.setItem("amexFavorites",JSON.stringify(d.favorites||[])),localStorage.setItem("amexTheme",d.theme||"light"),localStorage.setItem("amexPurchases",JSON.stringify(d.purchases||[])),d.profileAvatar?localStorage.setItem("amexProfileAvatar",d.profileAvatar):localStorage.removeItem("amexProfileAvatar")}},P={open:i=>{let o=document.getElementById(i);o&&(o.classList.add("active"),o.hidden=!1)},close:i=>{let o=document.getElementById(i);o&&(o.classList.remove("active"),o.hidden=!0)}},D=()=>{d.theme==="dark"?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")};document.addEventListener("DOMContentLoaded",()=>{D();let i=M({AppState:d,Utils:k,Modal:P},{autoShowAuth:!1,persistAuthOnLogin:!1,profilePortalUrl:null,profilePortalTarget:"_self"});i.initialize();let{Profile:o,Auth:l}=i;l!=null&&l.hide&&l.hide();let p=Array.from(document.querySelectorAll("[data-auth-guard]")),f=Array.from(document.querySelectorAll("[data-action]")),w=(a="")=>{let r=a.trim();return r?r.split(/\s+/)[0]:""},S=a=>{p.forEach(r=>{let u=r.dataset.authGuard==="auth"?a:!a;r.classList.toggle("guard-hidden",!u),r.setAttribute("aria-hidden",u?"false":"true")})},b=({logged:a=!1,hasPurchases:r=!1,hasActive:c=!1}={})=>{let u=document.getElementById("postPurchaseChecklist");if(!u)return;let m=(y,v)=>{let h=u.querySelector(`[data-step="${y}"]`);if(!h)return;h.dataset.state=v?"complete":"pending";let E=h.querySelector("[data-status]");E&&(E.textContent=v?"Conclu\xEDdo":"Pendente")};m("login",a),m("download",r),m("activate",c),m("support",!1)},I=(a=!1)=>{let r=document.getElementById("dashboardStatTotal"),c=document.getElementById("dashboardStatActive"),u=document.getElementById("dashboardStatNext"),m=document.getElementById("dashboardStatNextLabel"),y=document.getElementById("dashboardStatFavorites"),v=document.getElementById("dashboardStatus");if(!o)return;let h=Array.isArray(d.purchases)?[...d.purchases]:[],E=Date.now(),C=1e3*60*60*24,F=h.map(g=>o.getPurchaseStatus?o.getPurchaseStatus(g):{className:"valid"}),x=h.filter((g,T)=>{var q;return((q=F[T])==null?void 0:q.className)!=="expired"}),B=h.filter(g=>g.expiresAt).map(g=>{let T=new Date(g.expiresAt);return{purchase:g,diffMs:T.getTime()-E}}).filter(({diffMs:g})=>g>0).sort((g,T)=>g.diffMs-T.diffMs)[0]||null,A="--",O="Nenhuma expiracao proxima.";if(B){let g=Math.ceil(B.diffMs/C);A=g<=1?"<24h":`${g}d`,O=g<=1?"Expira em menos de 24 horas.":`Renove em ate ${g} dias.`}r&&(r.textContent=h.length.toString()),c&&(c.textContent=x.length.toString()),u&&(u.textContent=A),m&&(m.textContent=O);let R=Array.isArray(d.favorites)?d.favorites.length:0;y&&(y.textContent=R.toString()),v&&(h.length===0?v.textContent=x.length?"Cliente ativo":a?"Conta cadastrada":"Conta convidada":x.length>0?v.textContent="Cliente ativo":v.textContent="Ultimas compras expiradas"),b({logged:a,hasPurchases:h.length>0,hasActive:x.length>0})},n=()=>{var h;let a=(l==null?void 0:l.isAuthenticated())&&!!d.currentUser;S(!!a);let r=document.getElementById("dashboardUserName"),c=document.getElementById("dashboardUserEmail"),u=document.getElementById("dashboardAvatar"),m=document.getElementById("dashboardStatus");if(!a){r&&(r.textContent="Ola, visitante"),c&&(c.textContent="Entre para visualizar suas informacoes e beneficios."),u&&(u.classList.remove("has-photo"),u.style.backgroundImage="",u.textContent="?"),I(!1),m&&(m.textContent="Conta convidada");return}let y=((h=d.currentUser)==null?void 0:h.name)||"Cliente Amex",v=w(y)||"Cliente";r&&(r.textContent=`Ola, ${v}`),c&&(c.textContent=`Voce esta autenticado como ${d.currentUser.email}`),u&&(o!=null&&o.applyAvatarToElement)&&o.applyAvatarToElement(u,y,v.charAt(0).toUpperCase()),I(!0)},L=a=>{if(!o||typeof o[a]!="function")return;let r=o[a].bind(o);o[a]=(...c)=>{let u=r(...c);return n(),u}};["updateUI","renderPurchases","onLogin","onLogout","onPurchaseRecorded"].forEach(L),n();let N=()=>{let a=document.getElementById("dashboardHistory");a&&(o==null||o.renderPurchases(),a.scrollIntoView({behavior:"smooth",block:"start"}))},t=a=>{if(!a)return;let r=(l==null?void 0:l.isAuthenticated())&&!!d.currentUser;switch(a){case"edit-profile":if(!r){l==null||l.show("loginForm");return}P.open("profileModal"),requestAnimationFrame(()=>{var c,u;(c=document.getElementById("profileModal"))==null||c.scrollIntoView({behavior:"smooth",block:"start"}),(u=document.getElementById("profileName"))==null||u.focus()});break;case"view-history":case"open-history":if(!r){l==null||l.show("loginForm");return}N();break;case"open-support":k.openSupportChannel();break;case"open-login":l==null||l.show("loginForm");break;case"open-register":l==null||l.show("registerForm");break;case"manage-avatar":if(!r){l==null||l.show("loginForm");return}P.open("profileModal"),requestAnimationFrame(()=>{var c,u;(c=document.getElementById("profileModal"))==null||c.scrollIntoView({behavior:"smooth",block:"start"}),(u=document.getElementById("profileAvatarTrigger"))==null||u.focus()});break;case"open-faq":window.open("amexstore.html#faq","_blank");break;case"open-preferences":k.showToast("Em breve: central de preferencias personalizadas.","info");break;default:break}};f.forEach(a=>{a.addEventListener("click",r=>{r.preventDefault(),t(a.dataset.action)})});let e=document.getElementById("closeProfileModal");e&&e.addEventListener("click",()=>{P.close("profileModal")});let s=document.querySelector(".account-brand");s&&s.addEventListener("click",()=>{window.location.href="amexstore.html"}),window.addEventListener("storage",a=>{if(a.key==="amexTheme")d.theme=a.newValue||"light",D();else if(a.key==="amexPurchases"){try{d.purchases=JSON.parse(a.newValue||"[]")}catch(r){d.purchases=[]}n()}else if(a.key==="amexFavorites"){try{d.favorites=JSON.parse(a.newValue||"[]")}catch(r){d.favorites=[]}n()}else a.key==="amexProfileAvatar"&&(d.profileAvatar=a.newValue||null,n())})});
//# sourceMappingURL=account-page.js.map
